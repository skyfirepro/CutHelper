<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä—É–ª–æ–Ω–æ–≤</title>

    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#007BFF">
    <link rel="apple-touch-icon" href="./ios/180.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./ios/180.png">

    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f0f0;
            transition: background-color 0.3s, color 0.3s;
            color: #333;
            margin: 0px 5px 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: #f0f0f0;
            border-radius: 20px;
            box-shadow: 10px 10px 20px rgba(163, 163, 163, 0.4),
                -10px -10px 20px rgba(255, 255, 255, 0.8);
            width: 450px;
            transition: background-color 0.3s, color 0.3s;
            margin: 10px auto;
            padding: 20px;
            position: relative;
        }

        /* --- –ò–ó–ú–ï–ù–ï–ù–ò–ï –î–õ–Ø –õ–£–ß–®–ï–ì–û –ö–û–ù–¢–†–ê–°–¢–ê –í –°–í–ï–¢–õ–û–ô –¢–ï–ú–ï --- */
        #themeToggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #b5b3b3;
            /* –ë–æ–ª–µ–µ —Ç–µ–º–Ω—ã–π —Å–µ—Ä—ã–π –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
            border: none;
            padding: 10px 12px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 6px 6px 12px rgba(163, 163, 163, 0.5), -6px -6px 12px rgba(255, 255, 255, 0.7);
            font-size: 18px;
        }

        /* -------------------------------------------------------- */

        .checkbox-container {
            display: flex;
            align-items: center;
            margin-top: 15px;
            gap: 10px;
        }

        .checkbox-container .form-input-checkbox {
            width: auto;
            margin: 0;
            box-shadow: none;
            min-height: 20px;
        }

        .checkbox-container .form-label {
            display: inline;
            margin-top: 0;
            font-weight: normal;
            cursor: pointer;
        }

        .main-title-link {
            margin-top: 15px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 18px;
            color: #007BFF;
            text-decoration: none;
            display: block;
            cursor: pointer;
        }

        .main-title-link:hover {
            text-decoration: underline;
        }

        .text-underline {
            text-decoration: none;
            border-bottom: 1px solid currentColor;
            display: inline;
        }

        .underlined-title {
            display: block;
            font-size: 1.17em;
            font-weight: bold;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        .correction-label {
            font-size: 1.17em;
            margin-top: 25px;
            margin-bottom: 5px;
        }

        .form-label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            box-sizing: border-box;
            border: none;
            border-radius: 10px;
            background-color: #f0f0f0;
            color: #333;
            box-shadow: inset 5px 5px 10px #babecc, inset -5px -5px 10px #fff;
            transition: box-shadow 0.3s, border-color 0.3s;
        }

        .form-input.input-error {
            border: 1px solid #dc3545;
            box-shadow: inset 2px 2px 5px #dc354566, inset -2px -2px 5px #dc354566;
        }

        .form-input:disabled,
        .form-select:disabled {
            background-color: #e0e0e0;
            color: #999;
            box-shadow: inset 2px 2px 5px #babecc, inset -2px -2px 5px #fff;
            cursor: default;
            border-color: transparent;
        }

        .form-input:not(:disabled),
        .form-select:not(:disabled) {
            cursor: text;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            margin-top: 30px;
            margin-bottom: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 5px 5px 10px rgba(163, 163, 163, 0.4), -5px -5px 10px rgba(255, 255, 255, 0.8);
        }

        .calculate-btn:hover {
            background-color: #0056b3;
        }

        .reset-btn {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            margin-bottom: 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 5px 5px 10px rgba(163, 163, 163, 0.4), -5px -5px 10px rgba(255, 255, 255, 0.8);
            transition: background-color 0.3s;
        }

        .reset-btn:hover {
            background-color: #c82333;
        }

        .result-title {
            font-size: 22px;
            margin-top: 15px;
            margin-bottom: 25px;
            text-align: center;
        }

        h3 {
            margin: 0;
        }


        #result {
            font-size: 1em;
            font-weight: bold;
            color: rgb(149, 27, 27);
            margin-top: 0;
            margin-bottom: 15px;
        }

        #resultsTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9em;
            text-align: center;
            display: none;
            /* --- –ü–†–ê–í–ò–õ–ê –î–õ–Ø –§–ò–ö–°–ò–†–û–í–ê–ù–ù–û–ô –®–ò–†–ò–ù–´ --- */
            table-layout: fixed;
        }

        #resultsTable th,
        #resultsTable td {
            padding: 8px 4px;
            border-bottom: 1px solid #ddd;
            width: 25%;
            word-wrap: break-word;
            text-align: center;
        }

        #resultsTable th {
            text-align: center;
            background-color: #007BFF;
            color: white;
            font-weight: normal;
        }

        #resultsTable tbody tr:nth-child(even) {
            background-color: #e6e6e6;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            width: 80%;
            max-width: 300px;
            color: #333;
        }

        .modal-content.neumorphic-modal {
            background-color: #f0f0f0;
            box-shadow: 10px 10px 20px rgba(163, 163, 163, 0.4), -10px -10px 20px rgba(255, 255, 255, 0.8);
        }

        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-around;
        }

        .modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 5px 5px 10px rgba(163, 163, 163, 0.4), -5px -5px 10px rgba(255, 255, 255, 0.8);
        }

        .modal-buttons button:first-child {
            background-color: #dc3545;
            color: white;
        }

        .modal-buttons button:last-child {
            background-color: #f0f0f0;
            color: #333;
        }

        body.dark-mode {
            background-color: #1e1e1e;
            color: #e0e0e0;
        }

        body.dark-mode .container {
            background-color: #1e1e1e;
            box-shadow: 10px 10px 20px rgba(0, 0, 0, 0.4),
                -10px -10px 20px rgba(60, 60, 60, 0.4);
        }

        body.dark-mode .form-input,
        body.dark-mode .form-select {
            background-color: #1e1e1e;
            color: #e0e0e0;
            box-shadow: inset 5px 5px 10px rgba(0, 0, 0, 0.4), inset -5px -5px 10px rgba(60, 60, 60, 0.4);
        }

        body.dark-mode .form-input.input-error {
            border: 1px solid #ff6666;
            box-shadow: inset 2px 2px 5px #ff666666, inset -2px -2px 5px #ff666666;
        }

        body.dark-mode .form-input:disabled,
        body.dark-mode .form-select:disabled {
            background-color: #2c2c2c;
            color: #777;
            box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.4), inset -2px -2px 5px rgba(60, 60, 60, 0.4);
        }

        body.dark-mode .calculate-btn {
            background-color: #0056b3;
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.4), -5px -5px 10px rgba(60, 60, 60, 0.4);
        }

        body.dark-mode .reset-btn {
            background-color: #a33b47;
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.4), -5px -5px 10px rgba(60, 60, 60, 0.4);
        }

        body.dark-mode #resultsTable th {
            background-color: #0056b3;
        }

        body.dark-mode #resultsTable tbody tr:nth-child(even) {
            background-color: #2c2c2c;
        }

        /* --- –ò–ó–ú–ï–ù–ï–ù–ò–ï –î–õ–Ø –õ–£–ß–®–ï–ì–û –ö–û–ù–¢–†–ê–°–¢–ê –í –¢–ï–ú–ù–û–ô –¢–ï–ú–ï --- */
        body.dark-mode #themeToggle {
            background-color: #626262;
            /* –ë–æ–ª–µ–µ —Å–≤–µ—Ç–ª—ã–π —Ç–µ–º–Ω—ã–π —Å–µ—Ä—ã–π –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.4), -5px -5px 10px rgba(80, 80, 80, 0.4);
        }

        /* -------------------------------------------------------- */


        body.dark-mode .main-title-link {
            color: #4da6ff;
        }

        body.dark-mode .result-title {
            color: #ffffff;
        }

        body.dark-mode .modal-content.neumorphic-modal {
            background-color: #1e1e1e;
            box-shadow: 10px 10px 20px rgba(0, 0, 0, 0.4), -10px -10px 20px rgba(60, 60, 60, 0.4);
            color: #e0e0e0;
        }

        body.dark-mode .modal-buttons button {
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.4), -5px -5px 10px rgba(60, 60, 60, 0.4);
        }

        body.dark-mode .modal-buttons button:last-child {
            background-color: #1e1e1e;
            color: #e0e0e0;
        }

        @media (max-width: 500px) {
            body {
                padding-top: 10px;
            }

            .container {
                width: 90%;
                margin-left: auto;
                margin-right: auto;
            }

            /* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–¥–Ω–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–µ–º—ã */
            #themeToggle {
                top: 0px;
                right: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="container" id="calculatorContainer">
        <button id="themeToggle" onclick="toggleTheme()"></button>

        <h2 class="main-title-link">
            –†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ <br> –Ω–∞–º–æ—Ç–æ—á–Ω—ã—Ö —Ä—É–ª–æ–Ω–æ–≤ –∏ –æ—Å—Ç–∞—Ç–∫–∞
        </h2>

        <div class="underlined-title"><span class="text-underline">–ú–∞—Ç–æ—á–Ω—ã–π —Ä—É–ª–æ–Ω</span></div>
        <label for="distanceToEdge" class="form-label">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —à–ø—É–ª–∏ –¥–æ –≤–Ω–µ—à–Ω–µ–≥–æ –∫—Ä–∞—è —Ñ–æ–ª—å–≥–∏ (–º–º):</label>
        <input type="number" id="distanceToEdge" class="form-input">

        <div class="checkbox-container">
            <input type="checkbox" id="useRupture" onchange="toggleRuptureField()" class="form-input-checkbox">
            <label for="useRupture" class="form-label">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ –ø–æ—Ä—ã–≤–∞</label>
        </div>
        <label for="distanceToRupture" class="form-label">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —à–ø—É–ª–∏ –¥–æ –ø–æ—Ä—ã–≤–∞ (–º–º):</label>
        <input type="number" id="distanceToRupture" disabled class="form-input">
        <label for="masterCore" class="form-label">–î–∏–∞–º–µ—Ç—Ä —à–ø—É–ª–∏ –º–∞—Ç–æ—á–Ω–æ–≥–æ —Ä—É–ª–æ–Ω–∞ (–º–º):</label>
        <input type="number" id="masterCore" value="660" class="form-input">

        <div class="underlined-title"><span class="text-underline">–ù–∞–º–æ—Ç–æ—á–Ω—ã–π —Ä—É–ª–æ–Ω</span></div>
        <label for="targetOuter" class="form-label">–ö–æ–Ω–µ—á–Ω—ã–π (–Ω–æ–º–∏–Ω–∞–ª—å–Ω—ã–π) –¥–∏–∞–º–µ—Ç—Ä –Ω–∞–º–æ—Ç–æ—á–Ω–æ–≥–æ —Ä—É–ª–æ–Ω–∞ (–º–º):</label>
        <input type="number" id="targetOuter" class="form-input">

        <label for="targetCoreSelector" class="form-label">–î–∏–∞–º–µ—Ç—Ä –Ω–∞–º–æ—Ç–æ—á–Ω–æ–π —à–ø—É–ª–∏ (–º–º):</label>
        <select id="targetCoreSelector" class="form-select">
            <option value="81.2">81.2 (–≤–Ω. –¥–∏–∞–º–µ—Ç—Ä 76.2 + —Å—Ç–µ–Ω–∫–∞ 2.5)</option>
            <option value="158.4">158.4 (–≤–Ω. –¥–∏–∞–º–µ—Ç—Ä 152.4 + —Å—Ç–µ–Ω–∫–∞ 3)</option>
        </select>

        <label for="densityCorrection" class="form-label correction-label">
            <span class="text-underline">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏</span>
        </label>
        <input type="number" id="densityCorrection" value="1.0" step="0.01" class="form-input">

        <button class="calculate-btn" onclick="calculateRolls()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</button>

        <button class="reset-btn" onclick="showResetConfirmation()">–°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

        <h2 class="result-title">–†–µ–∑—É–ª—å—Ç–∞—Ç:</h2>
        <p id="result">–í–≤–µ–¥–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞.</p>

        <table id="resultsTable">
            <thead>
                <tr>
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—É–ª–æ–Ω–æ–≤ (—à—Ç)</th>
                    <th>–¢–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</th>
                    <th>–û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —à–ø—É–ª–µ –ø–µ—Ä–µ–¥ —Ä–µ–∑–∫–æ–π (–º–º)</th>
                    <th>–û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —à–ø—É–ª–µ –ø–æ—Å–ª–µ —Ä–µ–∑–∫–æ–π (–º–º)</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>


        <div id="confirmationModal" class="modal">
            <div class="modal-content neumorphic-modal">
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ø–æ–ª—è –≤–≤–æ–¥–∞?</p>
                <div class="modal-buttons">
                    <button onclick="resetForm(true)">–î–∞</button>
                    <button onclick="resetForm(false)">–ù–µ—Ç</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleTheme() {
            const body = document.body;
            body.classList.toggle('dark-mode');
            const themeButton = document.getElementById('themeToggle');

            if (body.classList.contains('dark-mode')) {
                themeButton.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            } else {
                themeButton.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            }
        }

        window.onload = function () {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                // –ò–∑–±–µ–≥–∞–µ–º –¥–≤–æ–π–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
                document.body.classList.add('dark-mode');
                document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
            } else {
                document.getElementById('themeToggle').textContent = 'üåô';
            }
        }
        function formatNumberForDisplay(num, decimalPlaces = 1) {
            if (isNaN(num) || !isFinite(num)) return '‚Äî';

            const fixedString = num.toFixed(decimalPlaces);
            return decimalPlaces === 0 ? parseInt(fixedString) : parseFloat(fixedString);
        }

        function toggleErrorClass(elementId, isValid) {
            const element = document.getElementById(elementId);
            if (element) {
                if (isValid) {
                    element.classList.remove('input-error');
                } else {
                    element.classList.add('input-error');
                }
            }
        }

        function toggleRuptureField() {
            const useRuptureCheckbox = document.getElementById('useRupture');
            const distanceToRuptureInput = document.getElementById('distanceToRupture');

            if (useRuptureCheckbox.checked) {
                distanceToRuptureInput.disabled = false;
            } else {
                distanceToRuptureInput.disabled = true;
                distanceToRuptureInput.value = '';
                toggleErrorClass('distanceToRupture', true);
            }
        }

        function calculateRolls() {
            const inputs = ['distanceToEdge', 'distanceToRupture', 'masterCore', 'targetOuter', 'densityCorrection'];
            inputs.forEach(id => toggleErrorClass(id, true));

            const distanceToEdge = parseFloat(document.getElementById('distanceToEdge').value);
            const distanceToRupture = parseFloat(document.getElementById('distanceToRupture').value);
            const useRupture = document.getElementById('useRupture').checked;
            const d_master = parseFloat(document.getElementById('masterCore').value);
            const D_target = parseFloat(document.getElementById('targetOuter').value);
            const d_target = parseFloat(parseFloat(document.getElementById('targetCoreSelector').value).toFixed(1));
            const K_correction = parseFloat(document.getElementById('densityCorrection').value);
            const resultElement = document.getElementById('result');
            const tableBody = document.getElementById('tableBody');
            const resultsTable = document.getElementById('resultsTable');

            resultElement.style.color = "red";
            resultsTable.style.display = "none";
            tableBody.innerHTML = '';

            let hasError = false;

            if (isNaN(distanceToEdge) || distanceToEdge <= 0) {
                toggleErrorClass('distanceToEdge', false);
                hasError = true;
            }

            if (useRupture && (isNaN(distanceToRupture) || distanceToRupture <= 0)) {
                toggleErrorClass('distanceToRupture', false);
                hasError = true;
            }

            if (isNaN(d_master) || d_master <= 0) { toggleErrorClass('masterCore', false); hasError = true; }
            if (isNaN(D_target) || D_target <= 0) { toggleErrorClass('targetOuter', false); hasError = true; }
            if (isNaN(K_correction) || K_correction <= 0) { toggleErrorClass('densityCorrection', false); hasError = true; }


            if (hasError) {
                resultElement.textContent = "–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞: –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —á–∏—Å–ª–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.";
                return;
            }

            const D_master_initial = d_master + (2 * distanceToEdge);

            let D_master_final;

            if (useRupture) {
                D_master_final = d_master + (2 * distanceToRupture);

                if (D_master_final >= D_master_initial) {
                    resultElement.textContent = "–û—à–∏–±–∫–∞ –ª–æ–≥–∏–∫–∏: –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –ø–æ—Ä—ã–≤–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é –¥–æ –≤–Ω–µ—à–Ω–µ–≥–æ –∫—Ä–∞—è —Ä—É–ª–æ–Ω–∞.";
                    toggleErrorClass('distanceToRupture', false);
                    return;
                }
            } else {
                D_master_final = d_master;
            }

            if (D_target <= d_target) {
                resultElement.textContent = "–û—à–∏–±–∫–∞ –ª–æ–≥–∏–∫–∏: –ö–æ–Ω–µ—á–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä –Ω–∞–º–æ—Ç–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ –¥–∏–∞–º–µ—Ç—Ä–∞ –Ω–∞–º–æ—Ç–æ—á–Ω–æ–π —à–ø—É–ª–∏.";
                toggleErrorClass('targetOuter', false);
                return;
            }
            if (D_master_initial < D_target) {
                resultElement.textContent = "–û—à–∏–±–∫–∞ –ª–æ–≥–∏–∫–∏: –ö–æ–Ω–µ—á–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä –Ω–∞–º–æ—Ç–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ, —á–µ–º –≤–Ω–µ—à–Ω–∏–π –¥–∏–∞–º–µ—Ç—Ä –º–∞—Ç–æ—á–Ω–æ–≥–æ —Ä—É–ª–æ–Ω–∞.";
                toggleErrorClass('targetOuter', false);
                toggleErrorClass('distanceToEdge', false);
                return;
            }

            resultElement.textContent = "";
            resultsTable.style.display = "table";
            resultElement.style.color = "initial";

            // –†–∞—Å—á–µ—Ç: –ü–ª–æ—â–∞–¥—å = D^2 - d^2
            const areaTargetBase = Math.pow(D_target, 2) - Math.pow(d_target, 2);
            const adjustedAreaTarget = areaTargetBase / K_correction;

            const areaMasterTotal = Math.pow(D_master_initial, 2) - Math.pow(D_master_final, 2);

            let fullRollsCount = 0;
            let areaRemainingMaster = areaMasterTotal;

            while (areaRemainingMaster >= adjustedAreaTarget) {
                fullRollsCount++;
                areaRemainingMaster -= adjustedAreaTarget;
            }

            const totalRollsExactInitial = areaMasterTotal / adjustedAreaTarget;

            if (fullRollsCount === 0) {
                const row = tableBody.insertRow();
                const cell1 = row.insertCell(0);
                const cell2 = row.insertCell(1);
                const cell3 = row.insertCell(2);
                const cell4 = row.insertCell(3);

                const exactCountDisplay = formatNumberForDisplay(totalRollsExactInitial, 2);
                const distanceEdgeDisplay = formatNumberForDisplay(distanceToEdge, 1);

                cell1.textContent = '0';
                cell2.textContent = exactCountDisplay;
                cell3.textContent = distanceEdgeDisplay;
                cell4.textContent = '‚Äî';

            } else {
                for (let i = fullRollsCount; i > 0; i--) {
                    const row = tableBody.insertRow();

                    const rollsAlreadyMade = fullRollsCount - i;
                    const currentExactRemaining = totalRollsExactInitial - rollsAlreadyMade;

                    // –†–∞—Å—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–∞ –ø–µ—Ä–µ–¥ —Ä–µ–∑–∫–æ–π —ç—Ç–æ–≥–æ —Ä—É–ª–æ–Ω–∞
                    const areaBeforeThisRoll = areaMasterTotal - (rollsAlreadyMade * adjustedAreaTarget);
                    const D_before = Math.sqrt(areaBeforeThisRoll + Math.pow(D_master_final, 2));
                    const remainingDistanceBefore = (D_before - d_master) / 2;

                    // –†–∞—Å—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–∞ –ø–æ—Å–ª–µ —Ä–µ–∑–∫–æ–π —ç—Ç–æ–≥–æ —Ä—É–ª–æ–Ω–∞
                    const areaAfterThisRoll = areaMasterTotal - ((rollsAlreadyMade + 1) * adjustedAreaTarget);
                    const D_after = Math.sqrt(areaAfterThisRoll + Math.pow(D_master_final, 2));
                    const remainingDistanceAfter = (D_after - d_master) / 2;

                    const countDisplay = i;
                    const exactDisplay = formatNumberForDisplay(currentExactRemaining, 2);
                    const beforeDisplay = formatNumberForDisplay(remainingDistanceBefore, 1);
                    const afterDisplay = formatNumberForDisplay(remainingDistanceAfter, 1);

                    const cell1 = row.insertCell(0);
                    const cell2 = row.insertCell(1);
                    const cell3 = row.insertCell(2);
                    const cell4 = row.insertCell(3);

                    cell1.textContent = countDisplay;
                    cell2.textContent = exactDisplay;
                    cell3.textContent = beforeDisplay;
                    cell4.textContent = afterDisplay;
                }
            }
        }

        function showResetConfirmation() {
            const modal = document.getElementById('confirmationModal');
            modal.style.display = 'flex';
        }

        function resetForm(confirmed) {
            const modal = document.getElementById('confirmationModal');
            modal.style.display = 'none';

            if (confirmed) {
                document.getElementById('distanceToEdge').value = '';
                document.getElementById('distanceToRupture').value = '';
                document.getElementById('useRupture').checked = false;

                toggleRuptureField();

                document.getElementById('masterCore').value = '660';
                document.getElementById('targetOuter').value = '';
                document.getElementById('targetCoreSelector').value = '81.2';
                document.getElementById('densityCorrection').value = '1.0';

                const inputs = ['distanceToEdge', 'distanceToRupture', 'masterCore', 'targetOuter', 'densityCorrection'];
                inputs.forEach(id => toggleErrorClass(id, true));

                document.getElementById('resultsTable').style.display = 'none';
                document.getElementById('tableBody').innerHTML = '';

                document.getElementById('result').textContent = '–í–≤–µ–¥–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞.';
                document.getElementById('result').style.color = "rgb(149, 27, 27)";
            }
        }

        window.onclick = function (event) {
            const modal = document.getElementById('confirmationModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

    </script>

    <script>
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker (–¥–ª—è PWA –∏ –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–∞–±–æ—Ç—ã)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker: ', err);
                    });
            });
        }
    </script>
</body>

</html>
